#!/bin/sh

set -e

case "$1" in
    purge)
        if [ -d /opt/capanalysis ]; then
            rm -rf /opt/capanalysis
            echo 'drop database capanalysis;' > /tmp/dbrm
            echo 'drop user capana;' >> /tmp/dbrm
            sudo -u postgres psql -f /tmp/dbrm
            rm -f /tmp/dbrm
        fi
    
    ;;
    
    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        if [ -d /opt/capanalysis/www/app/tmp/cache ]; then
            rm -rf /opt/capanalysis/www/app/tmp/cache/models/*
            rm -rf /opt/capanalysis/www/app/tmp/cache/views/*
            rm -rf /opt/capanalysis/www/app/tmp/sessions/*
            rm -rf /opt/capanalysis/www/app/tmp/logs/*
        fi
        if [ -f /etc/apache2/sites-enabled/098-capana.conf ]; then
            rm -f /etc/apache2/sites-enabled/098-capana.conf
        fi
        
        apache2ctl restart
    
    ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
